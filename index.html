<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오마이데스크 - 나만의 정보 분석 데스크</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/modal.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
</head>

<body>
    <!-- 반응형 경고 오버레이 -->
    <div class="responsive-warning" id="responsiveWarning">
        <div class="warning-content">
            <div class="warning-icon">📱</div>
            <h3>화면을 넓혀주세요</h3>
            <p>오마이데스크는 데스크탑 환경에 최적화되어 있습니다.<br>
                최상의 경험을 위해 화면 크기를 1200px 이상으로 조정해주세요.</p>
        </div>
    </div>

    <!-- 메인 앱 컨테이너 -->
    <div class="app-container" id="appContainer">
        <!-- 메뉴바 -->
        <nav class="menu-bar">
            <div class="menu-top">
                <div class="logo">
                    <span class="logo-text">OMYDESK</span>
                </div>
                <div class="menu-items">
                    <button class="menu-item active" data-tab="briefing">
                        <i class="ph-fill ph-house menu-icon-active"></i>
                        <i class="ph ph-house menu-icon-inactive"></i>
                        <span class="menu-label">브리핑</span>
                    </button>
                    <button class="menu-item" data-tab="projects">
                        <i class="ph-fill ph-folder menu-icon-active"></i>
                        <i class="ph ph-folder menu-icon-inactive"></i>
                        <span class="menu-label">내 프로젝트</span>
                    </button>
                    <button class="menu-item" data-tab="analysis">
                        <i class="ph-fill ph-chart-line menu-icon-active"></i>
                        <i class="ph ph-chart-line menu-icon-inactive"></i>
                        <span class="menu-label">분석 리포트</span>
                    </button>
                    <button class="menu-item" data-tab="settings">
                        <i class="ph-fill ph-gear menu-icon-active"></i>
                        <i class="ph ph-gear menu-icon-inactive"></i>
                        <span class="menu-label">설정</span>
                    </button>
                    <button class="menu-item" data-tab="help">
                        <i class="ph-fill ph-question menu-icon-active"></i>
                        <i class="ph ph-question menu-icon-inactive"></i>
                        <span class="menu-label">도움말</span>
                    </button>
                </div>
            </div>

            <!-- 프로필 섹션 -->
            <div class="profile-section">
                <button class="profile-button" id="profileButton">
                    <img src="images/profile.png" alt="프로필" class="profile-image">
                    <div class="profile-info">
                        <span class="profile-name">류호산</span>
                        <i class="ph ph-caret-up profile-arrow"></i>
                    </div>
                </button>

                <!-- 드롭다운 메뉴 -->
                <div class="profile-dropdown" id="profileDropdown">
                    <div class="profile-dropdown-content">
                        <button class="dropdown-item" id="accountManageBtn">
                            <i class="ph ph-user-circle"></i>
                            <span>계정 관리</span>
                        </button>
                        <button class="dropdown-item" id="logoutBtn">
                            <i class="ph ph-sign-out"></i>
                            <span>로그아웃</span>
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- 브리핑 탭 콘텐츠 -->
        <div class="tab-content active" id="briefingTab">
            <!-- 좌측 패널: 오늘의 브리핑 -->
            <aside class="left-panel">
                <header class="panel-header">
                    <div class="briefing-info">
                        <h1 class="panel-title">오늘의 브리핑</h1>
                        <p class="panel-subtitle" id="dateInfo">2024년 12월 19일 • 8개 이슈</p>
                    </div>
                    <div class="date-selector">
                        <input type="date" id="dateInput" value="2024-12-19">
                    </div>
                </header>

                <div class="briefing-cards" id="briefingCards">
                    <!-- 핵심 요약 섹션 -->
                    <div class="daily-summary">
                        <h3 class="summary-title">🔥 하이라이트</h3>
                        <p class="summary-text">정치·경제·사회 전반에 걸친 주요 이슈들이 복합적으로 얽혀 있는 상황입니다. 특히 정치적 긴장감이 높아지면서 경제 불안정성도 함께
                            증가하고 있습니다.</p>
                    </div>

                    <!-- 카드들이 동적으로 생성됩니다 -->
                </div>
            </aside>

            <!-- 중앙 패널: 비교 분석 데스크 -->
            <main class="center-panel">
                <!-- 메인 콘텐츠 영역 -->
                <div class="main-content">
                    <header class="analysis-header">
                        <div class="analysis-title-area">
                            <h2 class="analysis-title" id="analysisTitle">이슈를 선택해주세요</h2>
                            <p class="analysis-subtitle" id="analysisSubtitle">좌측에서 관심 있는 이슈를 클릭하면 상세 분석이 시작됩니다</p>
                        </div>
                        <div class="analysis-controls">
                            <button class="control-btn active" data-view="timeline">
                                <span>⭐</span> 리포트
                            </button>
                            <button class="control-btn" data-view="comparison">
                                <span>⚖️</span> 워딩 비교
                            </button>
                            <button class="control-btn" data-view="data">
                                <span>📊</span> 데이터 분석
                            </button>
                            <button class="control-btn" data-view="comparison">
                                <span>🥊</span> 비교/대립 분석
                            </button>
                        </div>
                    </header>

                    <div class="analysis-content" id="analysisContent">
                        <div class="empty-state">
                            <div class="empty-icon">🎯</div>
                            <h3>분석할 이슈를 선택해주세요</h3>
                            <p>좌측 브리핑에서 이슈를 클릭하면<br>상세 정보가 표시됩니다</p>
                        </div>
                    </div>
                </div>

                <!-- 우측 사이드바 -->
                <aside class="right-sidebar">
                    <!-- Table of Contents -->
                    <div class="toc-section">
                        <div class="toc-content" id="tocContent">
                            <div class="toc-empty">
                                <span>이슈를 선택하면<br>목차가 표시됩니다</span>
                            </div>
                        </div>
                    </div>

                    <!-- 출처 버튼 -->
                    <button class="sources-toggle-btn" id="sourcesToggleBtn" style="display: none;">
                        <span class="sources-count" id="sourcesCount">23</span>
                        <span>출처</span>
                    </button>

                    <!-- 출처 목록 패널 -->
                    <div class="sources-panel" id="sourcesPanel">
                        <div class="sources-panel-header">
                            <h3>출처</h3>
                            <button class="sources-panel-close" id="sourcesPanelClose">✕</button>
                        </div>
                        <div class="sources-panel-content" id="sourcesPanelContent">
                            <!-- 출처 목록이 여기에 표시됩니다 -->
                        </div>
                    </div>
                </aside>
            </main>
        </div>

        <!-- 프로젝트 탭 콘텐츠 -->
        <div class="tab-content" id="projectsTab">
            <div class="projects-container">
                <!-- 프로젝트 헤더 -->
                <header class="project-header">
                    <div class="project-title-section">
                        <div class="project-selector">
                            <select id="projectSelect" class="project-dropdown">
                                <option value="slowletter-1218">12/18 슬로우레터</option>
                                <option value="analysis-report">분석 리포트</option>
                                <option value="draft-column">칼럼 초안</option>
                            </select>
                            <i class="ph ph-caret-down dropdown-arrow"></i>
                        </div>
                        <p class="project-description">프로젝트의 베대를 설정하고 초안으로 내보내세요</p>
                    </div>
                    <div class="project-actions">
                        <button class="project-action-btn edit-btn" id="editProjectBtn">
                            <span>Edit</span>
                        </button>
                        <button class="project-action-btn new-btn" id="newProjectBtn">
                            <span>New</span>
                        </button>
                    </div>
                </header>

                <!-- 프로젝트 콘텐츠 -->
                <div class="project-content">
                    <div class="highlight-columns">
                        <!-- 첫 번째 컬럼 (빨간색 카테고리) -->
                        <div class="highlight-column" data-category="issues">
                            <div class="column-header">
                                <div class="category-badge red">
                                    <span class="category-count">3</span>
                                </div>
                            </div>
                            <div class="highlight-cards" id="issuesHighlights">
                                <!-- 예시 하이라이트 카드들 -->
                                <div class="highlight-card" draggable="true">
                                    <div class="highlight-tag red">하이라이터블 텍스트</div>
                                    <div class="highlight-content">
                                        <p>출처: 뉴욕타임즈 &lt; 성장주식대 금융투자&gt;</p>
                                        <span class="highlight-time">2024년 3월 14일 13:54</span>
                                    </div>
                                    <button class="highlight-menu-btn">
                                        <i class="ph ph-dots-three"></i>
                                    </button>
                                </div>
                                <div class="highlight-card" draggable="true">
                                    <div class="highlight-tag red">하이라이터블 텍스트</div>
                                    <div class="highlight-content">
                                        <p>출처: 뉴욕타임즈 &lt; 성장주식대 금융투자&gt;</p>
                                        <span class="highlight-time">2024년 3월 14일 13:54</span>
                                    </div>
                                    <button class="highlight-menu-btn">
                                        <i class="ph ph-dots-three"></i>
                                    </button>
                                </div>
                                <div class="highlight-card" draggable="true">
                                    <div class="highlight-tag red">하이라이터블 텍스트</div>
                                    <div class="highlight-content">
                                        <p>출처: 뉴욕타임즈 &lt; 성장주식대 금융투자&gt;</p>
                                        <span class="highlight-time">2024년 3월 14일 13:54</span>
                                    </div>
                                    <button class="highlight-menu-btn">
                                        <i class="ph ph-dots-three"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 두 번째 컬럼 (노란색 카테고리) -->
                        <div class="highlight-column" data-category="deep">
                            <div class="column-header">
                                <div class="category-badge yellow">
                                    <span class="category-count">1</span>
                                </div>
                            </div>
                            <div class="highlight-cards" id="deepHighlights">
                                <div class="highlight-card" draggable="true">
                                    <div class="highlight-tag yellow">하이라이터블 텍스트</div>
                                    <div class="highlight-content">
                                        <p>출처: 뉴욕타임즈 &lt; 성장주식대 금융투자&gt;</p>
                                        <span class="highlight-time">2024년 3월 14일 13:54</span>
                                    </div>
                                    <button class="highlight-menu-btn">
                                        <i class="ph ph-dots-three"></i>
                                    </button>
                                    <button class="highlight-action-btn">
                                        배경지식
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 세 번째 컬럼 (초록색 카테고리) -->
                        <div class="highlight-column" data-category="different">
                            <div class="column-header">
                                <div class="category-badge green">
                                    <span class="category-count">0</span>
                                </div>
                            </div>
                            <div class="highlight-cards" id="differentHighlights">
                                <!-- 비어있는 상태 -->
                            </div>
                        </div>

                        <!-- 네 번째 컬럼 (회색 카테고리) -->
                        <div class="highlight-column" data-category="tmi">
                            <div class="column-header">
                                <div class="category-badge gray">
                                    <span class="category-count">0</span>
                                </div>
                            </div>
                            <div class="highlight-cards" id="tmiHighlights">
                                <!-- 비어있는 상태 -->
                            </div>
                        </div>
                    </div>

                    <!-- 하단 액션 바 -->
                    <div class="project-footer">
                        <div class="footer-options">
                            <label class="checkbox-option">
                                <input type="checkbox" id="includeSourcesCheck" checked>
                                <span class="checkmark"></span>
                                <span class="checkbox-label">출처 포함</span>
                            </label>
                        </div>
                        <div class="footer-actions">
                            <button class="ai-export-btn" id="aiExportBtn">
                                <i class="ph ph-magic-wand"></i>
                                <span>AI 초안 내보내기</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 분석 리포트 탭 콘텐츠 -->
        <div class="tab-content" id="analysisTab">
            <div class="projects-container">
                <header class="projects-header">
                    <h1 class="projects-title">분석 리포트</h1>
                    <div class="projects-controls">
                        <button class="export-btn" title="리포트 내보내기">
                            <i class="ph ph-download-simple"></i>
                        </button>
                    </div>
                </header>

                <div class="projects-content">
                    <div class="empty-state">
                        <div class="empty-icon">📊</div>
                        <h3>분석 리포트 기능 준비 중</h3>
                        <p>곧 데이터 분석 및 리포트 기능이<br>추가될 예정입니다</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 설정 탭 콘텐츠 -->
        <div class="tab-content settings-tab" id="settingsTab">
            <div class="settings-container">


                <!-- 설정 대시보드 -->
                <div class="settings-dashboard">
                    <!-- 팔로우 관리 카드 -->
                    <div class="dashboard-card follow-card">
                        <div class="card-header">
                            <h2 class="card-title">팔로우 관리</h2>
                        </div>

                        <div class="card-content">
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <div class="stat-number">12</div>
                                    <div class="stat-label">등록 키워드</div>
                                    <button class="stat-action">
                                        <i class="ph ph-pencil-simple"></i>
                                    </button>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number">8</div>
                                    <div class="stat-label">SNS 팔로우</div>
                                    <button class="stat-action">
                                        <i class="ph ph-pencil-simple"></i>
                                    </button>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number">5</div>
                                    <div class="stat-label">기타 채널</div>
                                    <button class="stat-action">
                                        <i class="ph ph-pencil-simple"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="card-action-area">
                                <div class="input-group">
                                    <input type="url" class="link-input" placeholder="새 링크 추가 (RSS, 블로그 등)">
                                    <button class="add-btn">
                                        <i class="ph ph-plus"></i>
                                        추가
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 구독관리 카드 -->
                    <div class="dashboard-card billing-card">
                        <div class="card-header">
                            <h2 class="card-title">구독 관리</h2>
                        </div>

                        <div class="card-content">
                            <div class="subscription-status">
                                <div class="plan-badge pro">프로 플랜</div>
                                <div class="plan-price">₩29,000/월</div>
                            </div>

                            <div class="billing-info">
                                <div class="billing-item">
                                    <div class="billing-label">
                                        <i class="ph ph-calendar"></i>
                                        다음 결제일
                                    </div>
                                    <div class="billing-value">2024.01.19</div>
                                </div>
                                <div class="billing-item">
                                    <div class="billing-label">
                                        <i class="ph ph-credit-card"></i>
                                        결제 수단
                                    </div>
                                    <div class="billing-value">•••• 1234</div>
                                </div>
                            </div>

                            <div class="billing-actions">
                                <button class="action-btn primary">
                                    <i class="ph ph-arrow-up"></i>
                                    플랜 업그레이드
                                </button>
                                <button class="action-btn secondary">
                                    <i class="ph ph-receipt"></i>
                                    결제 내역
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 알림 설정 카드 -->
                    <div class="dashboard-card notification-card">
                        <div class="card-header">
                            <h2 class="card-title">알림 설정</h2>
                        </div>

                        <div class="card-content">
                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-label">브리핑 알림</div>
                                    <div class="setting-description">매일 아침 새로운 브리핑이 준비되면 알림을 받습니다</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-label">키워드 알림</div>
                                    <div class="setting-description">등록한 키워드 관련 새로운 이슈가 발견되면 알림을 받습니다</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-label">이메일 요약</div>
                                    <div class="setting-description">주간 분석 리포트를 이메일로 받습니다</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- 계정 정보 카드 -->
                    <div class="dashboard-card account-card">
                        <div class="card-header">
                            <h2 class="card-title">계정 정보</h2>
                        </div>

                        <div class="card-content">
                            <div class="account-profile">
                                <img src="images/profile.png" alt="프로필" class="account-avatar">
                                <div class="account-details">
                                    <div class="account-name">류호산</div>
                                    <div class="account-email">fbghtks1000@gmail.com</div>
                                    <div class="account-join-date">가입 2025.07.08</div>
                                </div>
                                <button class="edit-profile-btn">
                                    <i class="ph ph-pencil-simple"></i>
                                    편집
                                </button>
                            </div>

                            <div class="account-actions">
                                <button class="action-btn secondary">
                                    <i class="ph ph-key"></i>
                                    비밀번호 변경
                                </button>
                                <button class="action-btn danger">
                                    <i class="ph ph-trash"></i>
                                    계정 삭제
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 도움말 탭 콘텐츠 -->
        <div class="tab-content" id="helpTab">
            <div class="projects-container">
                <header class="projects-header">
                    <h1 class="projects-title">도움말</h1>
                </header>

                <div class="projects-content">
                    <div class="empty-state">
                        <div class="empty-icon">❓</div>
                        <h3>도움말 기능 준비 중</h3>
                        <p>사용법 가이드와 FAQ가<br>곧 추가될 예정입니다</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 기사 리더 모달 -->
    <div class="modal-overlay" id="readerModal">
        <div class="reader-modal">
            <header class="reader-header">
                <div class="reader-header-left">
                    <div class="reader-source" id="readerSource">출처</div>
                    <a href="#" class="reader-original-link" id="readerOriginalLink">
                        <i class="ph ph-arrow-square-out"></i>
                        원문 보기
                    </a>
                </div>
                <button class="reader-close" id="readerClose">✕</button>
            </header>
            <div class="reader-content">
                <div class="reader-article">
                    <h1 class="reader-title" id="readerTitle">기사 제목</h1>
                    <div class="reader-meta" id="readerMeta">
                        <span class="reader-date">2024.12.19</span>
                        <span class="reader-author">기자명</span>
                    </div>
                    <div class="reader-body" id="readerBody">
                        <p>기사 내용이 여기에 표시됩니다...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 하이라이트 메뉴 -->
    <div class="highlight-menu" id="highlightMenu">
        <button class="highlight-btn" data-category="issues" title="쟁점과 현안">
            <i class="ph ph-bookmark-simple" style="color: #FF3B30;"></i>
        </button>
        <button class="highlight-btn" data-category="deep" title="더 깊게 읽기">
            <i class="ph ph-bookmark-simple" style="color: #007AFF;"></i>
        </button>
        <button class="highlight-btn" data-category="different" title="다르게 읽기">
            <i class="ph ph-bookmark-simple" style="color: #34C759;"></i>
        </button>
        <button class="highlight-btn" data-category="tmi" title="오늘의 TMI">
            <i class="ph ph-bookmark-simple" style="color: #8E8E93;"></i>
        </button>
    </div>

    <!-- 툴팁 -->
    <div class="tooltip" id="tooltip"></div>

    <!-- JavaScript - 순서대로 로드 -->
    <script src="scripts/data.js"></script>
    <script src="scripts/components.js"></script>
    <script src="scripts/interactions.js"></script>
    <script src="scripts/main.js"></script>

    <script>
        // 탭 전환 기능
        function initializeTabs() {
            const menuItems = document.querySelectorAll('.menu-item');
            const tabContents = document.querySelectorAll('.tab-content');

            menuItems.forEach(item => {
                item.addEventListener('click', () => {
                    const tabName = item.dataset.tab;

                    // 메뉴 항목 활성화 상태 변경
                    menuItems.forEach(menu => menu.classList.remove('active'));
                    item.classList.add('active');

                    // 탭 콘텐츠 표시/숨김
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                    });

                    const targetTab = document.getElementById(tabName + 'Tab');
                    if (targetTab) {
                        targetTab.classList.add('active');

                        // 설정 탭 활성화 시 설정 기능 초기화
                        if (tabName === 'settings') {
                            initializeSettings();
                        }

                        // 프로젝트 탭 활성화 시 프로젝트 기능 초기화
                        if (tabName === 'projects') {
                            initializeProjects();
                        }
                    }
                });
            });
        }

        // 프로필 드롭다운 초기화
        function initializeProfileDropdown() {
            const profileButton = document.getElementById('profileButton');
            const profileDropdown = document.getElementById('profileDropdown');
            const accountManageBtn = document.getElementById('accountManageBtn');
            const logoutBtn = document.getElementById('logoutBtn');

            console.log('🔍 프로필 요소 확인:', {
                profileButton: !!profileButton,
                profileDropdown: !!profileDropdown,
                accountManageBtn: !!accountManageBtn,
                logoutBtn: !!logoutBtn
            });

            if (profileButton && profileDropdown) {
                // 프로필 버튼 클릭시 드롭다운 토글
                profileButton.addEventListener('click', function (e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('프로필 버튼 클릭됨');

                    const isOpen = profileDropdown.classList.contains('open');

                    if (isOpen) {
                        profileDropdown.classList.remove('open');
                        profileButton.classList.remove('active');
                        console.log('드롭다운 닫힘');
                    } else {
                        profileDropdown.classList.add('open');
                        profileButton.classList.add('active');
                        console.log('드롭다운 열림');
                    }
                });

                // 외부 클릭시 드롭다운 닫기
                document.addEventListener('click', function () {
                    profileDropdown.classList.remove('open');
                    profileButton.classList.remove('active');
                });

                // 드롭다운 내부 클릭시 이벤트 전파 방지
                profileDropdown.addEventListener('click', function (e) {
                    e.stopPropagation();
                });

                console.log('✅ 프로필 드롭다운 이벤트 리스너 설정 완료');
            } else {
                console.error('❌ 프로필 요소를 찾을 수 없습니다');
            }

            // 계정 관리 버튼
            if (accountManageBtn) {
                accountManageBtn.addEventListener('click', function () {
                    console.log('계정 관리 클릭됨');
                    alert('계정 관리 기능 준비 중입니다');
                    // 드롭다운 닫기
                    profileDropdown.classList.remove('open');
                    profileButton.classList.remove('active');
                });
            }

            // 로그아웃 버튼
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function () {
                    console.log('로그아웃 클릭됨');
                    if (confirm('정말 로그아웃하시겠습니까?')) {
                        alert('로그아웃되었습니다');
                        localStorage.clear();
                    }
                    // 드롭다운 닫기
                    profileDropdown.classList.remove('open');
                    profileButton.classList.remove('active');
                });
            }
        }

        // 설정 기능 초기화
        function initializeSettings() {
            console.log('🔧 설정 탭 기능 초기화');

            // 팔로우 관리 기능
            initializeFollowManagement();

            // 결제/구독 관리 기능
            initializeBillingActions();

            // 알림 설정 기능
            initializeNotificationSettings();

            // 계정 관리 기능
            initializeAccountActions();
        }

        // 팔로우 관리 기능
        function initializeFollowManagement() {
            // 통계 수정 버튼들
            const statActions = document.querySelectorAll('.settings-tab .stat-action');
            statActions.forEach(btn => {
                btn.addEventListener('click', function () {
                    const statItem = btn.closest('.stat-item');
                    const label = statItem.querySelector('.stat-label').textContent;
                    alert(`${label} 편집 기능 준비 중입니다`);
                });
            });

            // 링크 추가 기능
            const addBtn = document.querySelector('.settings-tab .add-btn');
            const linkInput = document.querySelector('.settings-tab .link-input');

            if (addBtn && linkInput) {
                addBtn.addEventListener('click', function () {
                    const url = linkInput.value.trim();
                    if (url) {
                        if (isValidUrl(url)) {
                            showSettingsNotification('링크가 추가되었습니다', 'success');
                            linkInput.value = '';
                            updateStats();
                        } else {
                            showSettingsNotification('올바른 URL을 입력해주세요', 'error');
                        }
                    } else {
                        showSettingsNotification('URL을 입력해주세요', 'warning');
                    }
                });

                // Enter 키로도 추가 가능
                linkInput.addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') {
                        addBtn.click();
                    }
                });
            }
        }

        // 결제/구독 관리 기능
        function initializeBillingActions() {
            // 플랜 업그레이드 버튼
            const upgradeBtn = document.querySelector('.settings-tab .action-btn.primary');
            if (upgradeBtn) {
                upgradeBtn.addEventListener('click', function () {
                    alert('플랜 업그레이드 기능 준비 중입니다');
                });
            }

            // 결제 내역 버튼
            const historyBtn = document.querySelector('.settings-tab .billing-actions .action-btn.secondary');
            if (historyBtn) {
                historyBtn.addEventListener('click', function () {
                    alert('결제 내역 기능 준비 중입니다');
                });
            }
        }

        // 알림 설정 기능
        function initializeNotificationSettings() {
            const toggles = document.querySelectorAll('.settings-tab .toggle-switch input');

            toggles.forEach(toggle => {
                toggle.addEventListener('change', function () {
                    const settingItem = this.closest('.setting-item');
                    const settingLabel = settingItem.querySelector('.setting-label').textContent;
                    const isEnabled = this.checked;

                    console.log(`${settingLabel}: ${isEnabled ? '활성화' : '비활성화'}`);

                    showSettingsNotification(
                        `${settingLabel} ${isEnabled ? '활성화' : '비활성화'}됨`,
                        'info'
                    );
                });
            });
        }

        // 계정 관리 기능
        function initializeAccountActions() {
            // 프로필 편집 버튼
            const editProfileBtn = document.querySelector('.settings-tab .edit-profile-btn');
            if (editProfileBtn) {
                editProfileBtn.addEventListener('click', function () {
                    alert('프로필 편집 기능 준비 중입니다');
                });
            }

            // 비밀번호 변경 버튼
            const changePasswordBtn = document.querySelector('.settings-tab .account-actions .action-btn.secondary');
            if (changePasswordBtn) {
                changePasswordBtn.addEventListener('click', function () {
                    alert('비밀번호 변경 기능 준비 중입니다');
                });
            }

            // 계정 삭제 버튼
            const deleteAccountBtn = document.querySelector('.settings-tab .action-btn.danger');
            if (deleteAccountBtn) {
                deleteAccountBtn.addEventListener('click', function () {
                    if (confirm('정말로 계정을 삭제하시겠습니까?\n이 작업은 되돌릴 수 없습니다.')) {
                        if (confirm('모든 데이터가 영구적으로 삭제됩니다.\n정말 진행하시겠습니까?')) {
                            alert('계정 삭제 기능 준비 중입니다');
                        }
                    }
                });
            }
        }

        // 유효한 URL인지 확인
        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        // 통계 업데이트
        function updateStats() {
            const statNumbers = document.querySelectorAll('.settings-tab .stat-number');
            statNumbers.forEach(num => {
                const currentValue = parseInt(num.textContent);
                num.textContent = currentValue + 1;

                // 애니메이션 효과
                num.style.transform = 'scale(1.2)';
                num.style.color = '#10b981';
                setTimeout(() => {
                    num.style.transform = 'scale(1)';
                    num.style.color = '#6366f1';
                }, 300);
            });
        }

        // 설정 알림 표시
        function showSettingsNotification(message, type = 'info') {
            // 기존 알림 제거
            const existingNotification = document.querySelector('.settings-notification');
            if (existingNotification) {
                existingNotification.remove();
            }

            // 새 알림 생성
            const notification = document.createElement('div');
            notification.className = `settings-notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <span class="notification-message">${message}</span>
                    <button class="notification-close">&times;</button>
                </div>
            `;

            // 스타일 적용
            Object.assign(notification.style, {
                position: 'fixed',
                top: '20px',
                right: '20px',
                padding: '1rem 1.5rem',
                borderRadius: '8px',
                color: 'white',
                fontSize: '14px',
                fontWeight: '500',
                zIndex: '9999',
                transform: 'translateX(100%)',
                transition: 'transform 0.3s ease',
                minWidth: '300px',
                boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.1)'
            });

            // 타입에 따른 색상 설정
            const colors = {
                success: '#10b981',
                error: '#ef4444',
                warning: '#f59e0b',
                info: '#3b82f6'
            };
            notification.style.backgroundColor = colors[type] || colors.info;

            // 페이지에 추가
            document.body.appendChild(notification);

            // 애니메이션으로 표시
            requestAnimationFrame(() => {
                notification.style.transform = 'translateX(0)';
            });

            // 닫기 버튼 이벤트
            const closeBtn = notification.querySelector('.notification-close');
            closeBtn.addEventListener('click', () => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            });

            // 3초 후 자동 제거
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => notification.remove(), 300);
                }
            }, 3000);
        }

        // 프로젝트 기능 초기화
        function initializeProjects() {
            console.log('📂 프로젝트 탭 기능 초기화');

            // 프로젝트 액션 버튼들
            initializeProjectActions();

            // 드래그 앤 드롭 기능
            initializeDragAndDrop();

            // AI 내보내기 기능
            initializeAIExport();

            // 하이라이트 카드 메뉴 기능
            initializeHighlightMenus();
        }

        // 프로젝트 액션 버튼 기능
        function initializeProjectActions() {
            const editBtn = document.getElementById('editProjectBtn');
            const newBtn = document.getElementById('newProjectBtn');
            const projectSelect = document.getElementById('projectSelect');

            if (editBtn) {
                editBtn.addEventListener('click', function () {
                    const currentProject = projectSelect.value;
                    const newName = prompt('프로젝트 이름을 입력하세요:', projectSelect.options[projectSelect.selectedIndex].text);
                    if (newName && newName.trim()) {
                        projectSelect.options[projectSelect.selectedIndex].text = newName.trim();
                        showProjectNotification('프로젝트 이름이 변경되었습니다', 'success');
                    }
                });
            }

            if (newBtn) {
                newBtn.addEventListener('click', function () {
                    const newName = prompt('새 프로젝트 이름을 입력하세요:');
                    if (newName && newName.trim()) {
                        const option = document.createElement('option');
                        option.value = newName.toLowerCase().replace(/\s+/g, '-');
                        option.text = newName.trim();
                        option.selected = true;
                        projectSelect.appendChild(option);
                        showProjectNotification('새 프로젝트가 생성되었습니다', 'success');
                    }
                });
            }

            if (projectSelect) {
                projectSelect.addEventListener('change', function () {
                    showProjectNotification('프로젝트가 전환되었습니다', 'info');
                });
            }
        }

        // 드래그 앤 드롭 기능
        function initializeDragAndDrop() {
            const highlightCards = document.querySelectorAll('#projectsTab .highlight-card');
            const highlightColumns = document.querySelectorAll('#projectsTab .highlight-cards');

            highlightCards.forEach(card => {
                card.addEventListener('dragstart', function (e) {
                    e.dataTransfer.setData('text/plain', '');
                    this.classList.add('dragging');
                });

                card.addEventListener('dragend', function () {
                    this.classList.remove('dragging');
                });
            });

            highlightColumns.forEach(column => {
                column.addEventListener('dragover', function (e) {
                    e.preventDefault();
                    this.classList.add('drag-over');
                });

                column.addEventListener('dragleave', function () {
                    this.classList.remove('drag-over');
                });

                column.addEventListener('drop', function (e) {
                    e.preventDefault();
                    this.classList.remove('drag-over');

                    const draggingCard = document.querySelector('#projectsTab .highlight-card.dragging');
                    if (draggingCard) {
                        this.appendChild(draggingCard);
                        updateCategoryCount();
                        showProjectNotification('카드가 이동되었습니다', 'success');
                    }
                });
            });
        }

        // 카테고리 카운트 업데이트
        function updateCategoryCount() {
            const columns = document.querySelectorAll('#projectsTab .highlight-column');
            columns.forEach(column => {
                const cards = column.querySelectorAll('.highlight-card');
                const badge = column.querySelector('.category-count');
                if (badge) {
                    badge.textContent = cards.length;
                }
            });
        }

        // AI 내보내기 기능
        function initializeAIExport() {
            const aiExportBtn = document.getElementById('aiExportBtn');
            const includeSourcesCheck = document.getElementById('includeSourcesCheck');

            if (aiExportBtn) {
                aiExportBtn.addEventListener('click', function () {
                    const includesSources = includeSourcesCheck.checked;
                    const highlightCards = document.querySelectorAll('#projectsTab .highlight-card');

                    if (highlightCards.length === 0) {
                        showProjectNotification('내보낼 하이라이트가 없습니다', 'warning');
                        return;
                    }

                    // AI 내보내기 시뮬레이션
                    this.innerHTML = '<i class="ph ph-spinner"></i><span>AI 생성 중...</span>';
                    this.disabled = true;

                    setTimeout(() => {
                        this.innerHTML = '<i class="ph ph-magic-wand"></i><span>AI 초안 내보내기</span>';
                        this.disabled = false;
                        showProjectNotification('AI 초안이 생성되었습니다', 'success');

                        // 실제로는 생성된 초안을 새 창이나 모달로 표시
                        console.log('AI 초안 생성 완료:', {
                            카드수: highlightCards.length,
                            출처포함: includesSources
                        });
                    }, 3000);
                });
            }
        }

        // 하이라이트 카드 메뉴 기능
        function initializeHighlightMenus() {
            const menuBtns = document.querySelectorAll('#projectsTab .highlight-menu-btn');
            const actionBtns = document.querySelectorAll('#projectsTab .highlight-action-btn');

            menuBtns.forEach(btn => {
                btn.addEventListener('click', function (e) {
                    e.stopPropagation();
                    const card = this.closest('.highlight-card');
                    // 간단한 컨텍스트 메뉴 시뮬레이션
                    const actions = ['편집', '복사', '삭제'];
                    const action = prompt('작업을 선택하세요:\n1. 편집\n2. 복사\n3. 삭제', '1');

                    switch (action) {
                        case '1':
                            showProjectNotification('편집 기능 준비 중입니다', 'info');
                            break;
                        case '2':
                            showProjectNotification('카드가 복사되었습니다', 'success');
                            break;
                        case '3':
                            if (confirm('이 하이라이트를 삭제하시겠습니까?')) {
                                card.remove();
                                updateCategoryCount();
                                showProjectNotification('하이라이트가 삭제되었습니다', 'success');
                            }
                            break;
                    }
                });
            });

            actionBtns.forEach(btn => {
                btn.addEventListener('click', function (e) {
                    e.stopPropagation();
                    showProjectNotification('배경지식 기능 준비 중입니다', 'info');
                });
            });
        }

        // 프로젝트 알림 표시
        function showProjectNotification(message, type = 'info') {
            showSettingsNotification(message, type); // 기존 알림 시스템 재사용
        }

        // 추가 안전장치: 모든 스크립트 로드 후 확인
        window.addEventListener('load', function () {
            console.log('🔍 스크립트 로드 상태 확인:', {
                issueClusters: window.issueClusters?.length || 0,
                projectTemplates: Object.keys(window.projectTemplates || {}).length,
                utils: !!window.utils,
                appState: !!window.appState,
                components: !!window.initializeComponents,
                interactions: !!window.initializeInteractions
            });

            // 탭 초기화
            initializeTabs();

            // 프로필 드롭다운 초기화
            initializeProfileDropdown();

            // 만약 데이터가 없다면 강제로 다시 시도
            if (!window.issueClusters || window.issueClusters.length === 0) {
                console.warn('⚠️ 데이터 로드 실패, 0.5초 후 재시도...');
                setTimeout(() => {
                    if (window.initializeComponents) {
                        window.initializeComponents();
                    }
                }, 500);
            }
        });
    </script>
</body>

</html>